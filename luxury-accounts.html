<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luxury Accounts Portal — Cloud Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#8b5cf6;--accent-2:#06b6d4;--glass: rgba(255,255,255,0.03);--radius:14px;font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #081127 60%);color:#e6eef8}
    .app{display:grid;grid-template-columns:260px 1fr;gap:20px;min-height:100vh;padding:24px}
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:18px;width:260px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:800}
    .nav{margin-top:18px}
    .nav button{display:flex;align-items:center;gap:10px;width:100%;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer}
    .nav button.active{background:linear-gradient(90deg,rgba(139,92,246,0.14),rgba(6,182,212,0.06));color:#fff}
    .main{padding:20px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));backdrop-filter: blur(6px)}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .search input{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:10px;color:#e6eef8}
    .actions{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#06121a}
    .card{margin-top:16px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    .tag{padding:6px 8px;border-radius:8px;font-weight:600}
    .credit{background:rgba(6,182,212,0.12);color:var(--accent-2)}
    .debit{background:rgba(139,92,246,0.12);color:var(--accent)}
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(2,6,23,0.5), rgba(2,6,23,0.7));z-index:60}
    .modal.open{display:flex}
    .modal-card{width:920px;border-radius:12px;padding:18px;background:linear-gradient(180deg,#061223,#061421);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef8}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:900px){.app{grid-template-columns:1fr}.modal-card{width:95%}}
  </style>
  <!-- jsPDF (for PDF invoices) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand"><div class="logo">LA</div><div><h1>Luxury Accounts</h1><div class="small">Cloud-enabled portal</div></div></div>
      <nav class="nav">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="transactions">Transactions</button>
        <button data-view="customers">Customers</button>
        <button data-view="reports">Reports</button>
        <button data-view="settings">Settings</button>
      </nav>
      <div style="margin-top:14px">
        <div id="authArea" class="small">Not signed in</div>
        <div style="margin-top:8px"><button class="btn ghost" id="signInBtn">Sign in</button> <button class="btn ghost" id="signOutBtn" style="display:none">Sign out</button></div>
      </div>
    </aside>

    <main class="main">
      <div class="top">
        <div class="search"><input id="globalSearch" placeholder="Search transactions, names, IDs..." /></div>
        <div class="actions">
          <button class="btn ghost" id="syncSheetsBtn">Sync ↕️ Sheets</button>
          <button class="btn ghost" id="exportBtn">Export CSV</button>
          <button class="btn primary" id="newTxnBtn">New Transaction</button>
        </div>
      </div>

      <div class="card">
        <div class="grid">
          <div class="stat"><div class="small">Total Balance</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="balance">0.00</span></div><div class="small">Updated live</div></div>
          <div class="stat"><div class="small">Total Credits</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="credits">0.00</span></div><div class="small">Sum of credits</div></div>
          <div class="stat"><div class="small">Total Debits</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="debits">0.00</span></div><div class="small">Sum of debits</div></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Transactions</h3>
          <div class="small">Total: <span id="totalCount">0</span></div>
        </div>
        <div class="table" style="margin-top:12px;border-radius:10px;overflow:auto">
          <table id="txTable"><thead><tr><th>Date</th><th>Type</th><th>Account / Name</th><th>Memo</th><th class="small right">Amount</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
      <footer>Cloud edition — Firebase + Google Sheets + PDF receipts</footer>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal"><div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center"><h2 id="modalTitle">New Transaction</h2><button class="btn ghost" id="closeModal">Close</button></div>
    <div style="margin-top:12px">
      <div style="display:flex;gap:12px"><div style="flex:1"><label class="small">Date</label><input id="txnDate" type="date" /></div><div style="flex:1"><label class="small">Type</label><select id="txnType"><option value="credit">Credit</option><option value="debit">Debit</option></select></div><div style="flex:1"><label class="small">Amount</label><input id="txnAmount" type="number" step="0.01" placeholder="0.00" /></div></div>
      <div style="display:flex;gap:12px;margin-top:12px"><div style="flex:1"><label class="small">Account</label><input id="txnAccount" placeholder="Cash / Bank / Customer" /></div><div style="flex:1"><label class="small">Category</label><input id="txnCategory" placeholder="Sales, Rent, Salary" /></div><div style="flex:1"><label class="small">Ref/ID</label><input id="txnRef" placeholder="Optional" /></div></div>
      <div style="margin-top:12px"><label class="small">Memo</label><textarea id="txnMemo" rows="3"></textarea></div>
      <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px"><button class="btn ghost" id="clearForm">Clear</button><button class="btn primary" id="saveTxn">Save</button></div>
    </div>
  </div></div>

  <input type="file" id="fileInput" accept="text/csv" style="display:none" />

  <script type="module">
    // ----- User-provided Firebase config (from you) -----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCBCgM7-0Pce2Ht6tRSJ2RmKo434tj3ZNM",
      authDomain: "luxury-accounts-entry.firebaseapp.com",
      projectId: "luxury-accounts-entry",
      storageBucket: "luxury-accounts-entry.firebasestorage.app",
      messagingSenderId: "329476149336",
      appId: "1:329476149336:web:92283a0f6314c32c437a2d",
      measurementId: "G-SNEZPY3L8Q"
    };

    const app = initializeApp(firebaseConfig);
    // optional analytics
    try{ getAnalytics(app) } catch(e) { console.warn('Analytics not available',e) }

    const auth = getAuth(app);
    const db = getFirestore(app);

    // Optional: set this to your Apps Script endpoint after you deploy it
    const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxImxFVwHEA7bPoIK3tfln7cCaY3DxqoqvckD4cbC4zfXK09Zi2pWq0iILVVlSWYWNG/exec';

    // local storage key
    const LOCAL_KEY = 'lux_accounts_txns_v3';

    // UI refs
    const txTableBody = document.querySelector('#txTable tbody');
    const balanceEl = document.getElementById('balance');
    const creditsEl = document.getElementById('credits');
    const debitsEl = document.getElementById('debits');
    const totalCountEl = document.getElementById('totalCount');
    const authArea = document.getElementById('authArea');
    const signInBtn = document.getElementById('signInBtn');
    const signOutBtn = document.getElementById('signOutBtn');

    let txns = []; let editId = null;

    function uid(){return 'id_'+Math.random().toString(36).slice(2,9)}
    function fmt(n){return Number(n||0).toLocaleString('en-IN',{minimumFractionDigits:2,maximumFractionDigits:2})}
    function escapeHtml(s){return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;')}

    function loadLocal(){try{txns = JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]')}catch(e){txns=[]}render();}
    function saveLocal(){localStorage.setItem(LOCAL_KEY,JSON.stringify(txns));render();}

    function render(){txTableBody.innerHTML='';let credits=0,debits=0;txns.slice().reverse().forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.date}</td><td><span class="tag ${t.type==='credit'?'credit':'debit'}">${t.type.toUpperCase()}</span></td><td>${escapeHtml(t.account||'')}</td><td>${escapeHtml(t.memo||'')}<div class="small">${escapeHtml(t.category||'')}</div></td><td class="right">₹ ${fmt(t.amount)}</td><td><button class="btn ghost" onclick="downloadInvoice('${t.id}')">PDF</button> <button class="btn ghost" onclick="editTxn('${t.id}')">Edit</button> <button class="btn ghost" onclick="deleteTxn('${t.id}')">Delete</button></td>`;txTableBody.appendChild(tr);if(Number(t.amount)>0){ if(t.type==='credit') credits+=Number(t.amount); else debits+=Number(t.amount) }});creditsEl.innerText=fmt(credits);debitsEl.innerText=fmt(debits);balanceEl.innerText=fmt(credits-debits);totalCountEl.innerText=txns.length}

    function newTxn(){editId=null;clearForm();openModal();document.getElementById('txnDate').value=new Date().toISOString().slice(0,10)}
    function clearForm(){document.getElementById('txnDate').value='';document.getElementById('txnType').value='credit';document.getElementById('txnAmount').value='';document.getElementById('txnAccount').value='';document.getElementById('txnCategory').value='';document.getElementById('txnRef').value='';document.getElementById('txnMemo').value='';}
    function openModal(){document.getElementById('modal').classList.add('open');document.getElementById('modalTitle').innerText=editId?'Edit Transaction':'New Transaction'}
    function closeModal(){document.getElementById('modal').classList.remove('open');editId=null;clearForm()}

    function editTxn(id){const t = txns.find(x=>x.id===id);if(!t) return alert('Not found');editId=id;document.getElementById('txnDate').value=t.date;document.getElementById('txnType').value=t.type;document.getElementById('txnAmount').value=t.amount;document.getElementById('txnAccount').value=t.account;document.getElementById('txnCategory').value=t.category;document.getElementById('txnRef').value=t.ref||'';document.getElementById('txnMemo').value=t.memo||'';openModal()}

    function deleteTxn(id){if(!confirm('Delete this transaction?'))return;txns=txns.filter(x=>x.id!==id);saveLocal();if(auth.currentUser) deleteFromCloud(id)}

    async function saveForm(){const date=document.getElementById('txnDate').value || new Date().toISOString().slice(0,10);const type=document.getElementById('txnType').value;const amount = Math.abs(Number(document.getElementById('txnAmount').value||0));if(!amount){return alert('Enter valid amount')}const account=document.getElementById('txnAccount').value;const category=document.getElementById('txnCategory').value;const ref=document.getElementById('txnRef').value;const memo=document.getElementById('txnMemo').value;if(editId){const idx = txns.findIndex(x=>x.id===editId);if(idx===-1)return alert('Edit failed');txns[idx] = {...txns[idx],date,type,amount,account,category,ref,memo};await updateCloud(txns[idx])} else {const obj={id:uid(),date,type,amount,account,category,ref,memo};txns.push(obj);await addToCloud(obj)}saveLocal();closeModal()}

    function exportCSV(){if(!txns.length) return alert('No transactions to export');const headers=['id','date','type','amount','account','category','ref','memo'];const csv = headers.join(',')+'
'+txns.map(t=>headers.map(h=>'"'+((t[h]||'').toString().replace(/"/g,'""'))+'"').join(',')).join('
');const blob = new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='luxury_txns.csv';a.click();URL.revokeObjectURL(url)}

    function downloadInvoice(id){const t = txns.find(x=>x.id===id);if(!t) return alert('Transaction not found');const { jsPDF } = window.jspdf;const doc = new jsPDF({unit:'pt',format:'a4'});const left=40;let y=60;doc.setFontSize(20);doc.text('Luxury Accounts — Invoice',left,y);y+=30;doc.setFontSize(12);doc.text(`Invoice ID: ${t.ref||t.id}`,left,y);y+=18;doc.text(`Date: ${t.date}`,left,y);y+=18;doc.text(`Account: ${t.account||''}`,left,y);y+=18;doc.text(`Category: ${t.category||''}`,left,y);y+=18;doc.text(`Memo: ${t.memo||''}`,left,y);y+=30;doc.setFontSize(14);doc.text(`Amount: ₹ ${fmt(t.amount)}`,left,y);y+=30;doc.setFontSize(10);doc.text('This is a system-generated invoice.',left,y);doc.save(`invoice_${t.id}.pdf`)}

    // ----------- Firestore helpers (modular) -----------
    async function addToCloud(tx){try{if(!auth.currentUser) return;await setDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',tx.id),tx);}catch(e){console.error('addToCloud',e)}}
    async function updateCloud(tx){try{if(!auth.currentUser) return;await setDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',tx.id),tx);}catch(e){console.error('updateCloud',e)}}
    async function deleteFromCloud(id){try{if(!auth.currentUser) return;await deleteDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',id));}catch(e){console.error('deleteFromCloud',e)}}

    async function pullFromCloud(){if(!auth.currentUser) return alert('Sign in to sync');try{const snap = await getDocs(collection(db,'users',auth.currentUser.uid,'txns'));const items=[];snap.forEach(d=>items.push(d.data()));txns = items;saveLocal();alert('Pulled '+items.length+' transactions from cloud')}catch(e){console.error(e);alert('Pull failed: '+e.message)}}

    async function pushToCloud(){if(!auth.currentUser) return alert('Sign in to sync');try{const collRef = collection(db,'users',auth.currentUser.uid,'txns');const existing = await getDocs(collRef);const batch = writeBatch(db);existing.forEach(d=>batch.delete(doc(collRef,d.id)));txns.forEach(t=>batch.set(doc(collRef,t.id),t));await batch.commit();alert('Pushed '+txns.length+' transactions to cloud')}catch(e){console.error(e);alert('Push failed: '+e.message)}}

    // ----------- Sheets sync (Apps Script) -----------
    async function syncWithSheets(){if(!SHEETS_ENDPOINT) return alert('Set SHEETS_ENDPOINT in the code');try{const res = await fetch(SHEETS_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'sync',txns})});const data = await res.json();if(data && data.txns){txns = data.txns;saveLocal();alert('Synced with Sheets: received '+data.txns.length+' rows')} else alert('Sheets sync complete')}catch(e){console.error(e);alert('Sheets sync failed: '+e.message)}}

    // ----------- Auth UI -----------
    const provider = new GoogleAuthProvider();
    async function startAuth(){try{await signInWithPopup(auth,provider)}catch(e){console.error('signin',e);alert('Sign-in failed: '+e.message)}}
    signInBtn.addEventListener('click',startAuth);
    signOutBtn.addEventListener('click',()=>signOut(auth));

    onAuthStateChanged(auth,user=>{if(user){authArea.innerText = `Signed in: ${user.displayName || user.email}`;signInBtn.style.display='none';signOutBtn.style.display='inline-block';pullFromCloud()} else {authArea.innerText='Not signed in';signInBtn.style.display='inline-block';signOutBtn.style.display='none'}});

    // CSV import
    function parseCSVLine(line){const out=[];let cur='';let inQ=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch==='"'){if(inQ && line[i+1]==='"'){cur+='"';i++} else {inQ=!inQ}} else if(ch===',' && !inQ){out.push(cur);cur=''} else {cur+=ch}}out.push(cur);return out.map(s=>s.replace(/^"|"$/g,'').replace(/""/g,'"'))}
    function importCSVFile(file){const reader=new FileReader();reader.onload=e=>{const text=e.target.result;const lines=text.split(/
?
/).filter(Boolean);if(!lines.length) return alert('CSV empty');const headers = lines[0].split(',').map(h=>h.replace(/"/g,'').trim());const newTx=[];for(let i=1;i<lines.length;i++){const cols=parseCSVLine(lines[i]);if(cols.length<headers.length) continue;const obj={};for(let j=0;j<headers.length;j++) obj[headers[j]] = cols[j];newTx.push({id:obj.id||uid(),date:obj.date||new Date().toISOString().slice(0,10),type:obj.type||'credit',amount:Math.abs(Number(obj.amount||0)),account:obj.account,category:obj.category,ref:obj.ref,memo:obj.memo});}txns = txns.concat(newTx);saveLocal();alert('Imported '+newTx.length+' rows')};reader.readAsText(file)}

    // Events
    document.getElementById('newTxnBtn').addEventListener('click',newTxn);
    document.getElementById('closeModal').addEventListener('click',closeModal);
    document.getElementById('saveTxn').addEventListener('click',saveForm);
    document.getElementById('clearForm').addEventListener('click',clearForm);
    document.getElementById('exportBtn').addEventListener('click',exportCSV);
    document.getElementById('syncSheetsBtn').addEventListener('click',syncWithSheets);
    document.getElementById('fileInput').addEventListener('change',e=>{if(e.target.files[0]) importCSVFile(e.target.files[0]);e.target.value='';});
    document.getElementById('globalSearch').addEventListener('input',function(e){const q=e.target.value.toLowerCase().trim();txTableBody.innerHTML='';const filtered=txns.filter(t=>[t.date,t.account,t.category,t.memo,t.ref,t.type,(t.amount||'')+""].join(' ').toLowerCase().includes(q));filtered.slice().reverse().forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.date}</td><td><span class="tag ${t.type==='credit'?'credit':'debit'}">${t.type.toUpperCase()}</span></td><td>${escapeHtml(t.account||'')}</td><td>${escapeHtml(t.memo||'')}<div class="small">${escapeHtml(t.category||'')}</div></td><td class="right">₹ ${fmt(t.amount)}</td><td><button class="btn ghost" onclick="downloadInvoice('${t.id}')">PDF</button> <button class="btn ghost" onclick="editTxn('${t.id}')">Edit</button> <button class="btn ghost" onclick="deleteTxn('${t.id}')">Delete</button></td>`;txTableBody.appendChild(tr);});});

    document.querySelectorAll('.nav button').forEach(b=>b.addEventListener('click',e=>{document.querySelectorAll('.nav button').forEach(x=>x.classList.remove('active'));b.classList.add('active');const view=b.dataset.view;if(view==='transactions') alert('Transactions view is dashboard here. Other views can be added.') }));

    // init
    loadLocal();
  </script>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luxury Accounts Portal — Cloud Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#8b5cf6;--accent-2:#06b6d4;--glass: rgba(255,255,255,0.03);--radius:14px;font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #081127 60%);color:#e6eef8}
    .app{display:grid;grid-template-columns:260px 1fr;gap:20px;min-height:100vh;padding:24px}
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:18px;width:260px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:800}
    .nav{margin-top:18px}
    .nav button{display:flex;align-items:center;gap:10px;width:100%;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer}
    .nav button.active{background:linear-gradient(90deg,rgba(139,92,246,0.14),rgba(6,182,212,0.06));color:#fff}
    .main{padding:20px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));backdrop-filter: blur(6px)}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .search input{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:10px;color:#e6eef8}
    .actions{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#06121a}
    .card{margin-top:16px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    .tag{padding:6px 8px;border-radius:8px;font-weight:600}
    .credit{background:rgba(6,182,212,0.12);color:var(--accent-2)}
    .debit{background:rgba(139,92,246,0.12);color:var(--accent)}
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(2,6,23,0.5), rgba(2,6,23,0.7));z-index:60}
    .modal.open{display:flex}
    .modal-card{width:920px;border-radius:12px;padding:18px;background:linear-gradient(180deg,#061223,#061421);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef8}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:900px){.app{grid-template-columns:1fr}.modal-card{width:95%}}
  </style>
  <!-- jsPDF (for PDF invoices) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand"><div class="logo">LA</div><div><h1>Luxury Accounts</h1><div class="small">Cloud-enabled portal</div></div></div>
      <nav class="nav">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="transactions">Transactions</button>
        <button data-view="customers">Customers</button>
        <button data-view="reports">Reports</button>
        <button data-view="settings">Settings</button>
      </nav>
      <div style="margin-top:14px">
        <div id="authArea" class="small">Not signed in</div>
        <div style="margin-top:8px"><button class="btn ghost" id="signInBtn">Sign in</button> <button class="btn ghost" id="signOutBtn" style="display:none">Sign out</button></div>
      </div>
    </aside>

    <main class="main">
      <div class="top">
        <div class="search"><input id="globalSearch" placeholder="Search transactions, names, IDs..." /></div>
        <div class="actions">
          <button class="btn ghost" id="syncSheetsBtn">Sync ↕️ Sheets</button>
          <button class="btn ghost" id="exportBtn">Export CSV</button>
          <button class="btn primary" id="newTxnBtn">New Transaction</button>
        </div>
      </div>

      <div class="card">
        <div class="grid">
          <div class="stat"><div class="small">Total Balance</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="balance">0.00</span></div><div class="small">Updated live</div></div>
          <div class="stat"><div class="small">Total Credits</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="credits">0.00</span></div><div class="small">Sum of credits</div></div>
          <div class="stat"><div class="small">Total Debits</div><div style="font-size:20px;font-weight:800;margin-top:8px">₹ <span id="debits">0.00</span></div><div class="small">Sum of debits</div></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Transactions</h3>
          <div class="small">Total: <span id="totalCount">0</span></div>
        </div>
        <div class="table" style="margin-top:12px;border-radius:10px;overflow:auto">
          <table id="txTable"><thead><tr><th>Date</th><th>Type</th><th>Account / Name</th><th>Memo</th><th class="small right">Amount</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
      <footer>Cloud edition — Firebase + Google Sheets + PDF receipts</footer>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal"><div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center"><h2 id="modalTitle">New Transaction</h2><button class="btn ghost" id="closeModal">Close</button></div>
    <div style="margin-top:12px">
      <div style="display:flex;gap:12px"><div style="flex:1"><label class="small">Date</label><input id="txnDate" type="date" /></div><div style="flex:1"><label class="small">Type</label><select id="txnType"><option value="credit">Credit</option><option value="debit">Debit</option></select></div><div style="flex:1"><label class="small">Amount</label><input id="txnAmount" type="number" step="0.01" placeholder="0.00" /></div></div>
      <div style="display:flex;gap:12px;margin-top:12px"><div style="flex:1"><label class="small">Account</label><input id="txnAccount" placeholder="Cash / Bank / Customer" /></div><div style="flex:1"><label class="small">Category</label><input id="txnCategory" placeholder="Sales, Rent, Salary" /></div><div style="flex:1"><label class="small">Ref/ID</label><input id="txnRef" placeholder="Optional" /></div></div>
      <div style="margin-top:12px"><label class="small">Memo</label><textarea id="txnMemo" rows="3"></textarea></div>
      <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px"><button class="btn ghost" id="clearForm">Clear</button><button class="btn primary" id="saveTxn">Save</button></div>
    </div>
  </div></div>

  <input type="file" id="fileInput" accept="text/csv" style="display:none" />

  <script type="module">
    // ----- User-provided Firebase config (from you) -----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCBCgM7-0Pce2Ht6tRSJ2RmKo434tj3ZNM",
      authDomain: "luxury-accounts-entry.firebaseapp.com",
      projectId: "luxury-accounts-entry",
      storageBucket: "luxury-accounts-entry.firebasestorage.app",
      messagingSenderId: "329476149336",
      appId: "1:329476149336:web:92283a0f6314c32c437a2d",
      measurementId: "G-SNEZPY3L8Q"
    };

    const app = initializeApp(firebaseConfig);
    // optional analytics
    try{ getAnalytics(app) } catch(e) { console.warn('Analytics not available',e) }

    const auth = getAuth(app);
    const db = getFirestore(app);

    // Optional: set this to your Apps Script endpoint after you deploy it
    const SHEETS_ENDPOINT = '';

    // local storage key
    const LOCAL_KEY = 'lux_accounts_txns_v3';

    // UI refs
    const txTableBody = document.querySelector('#txTable tbody');
    const balanceEl = document.getElementById('balance');
    const creditsEl = document.getElementById('credits');
    const debitsEl = document.getElementById('debits');
    const totalCountEl = document.getElementById('totalCount');
    const authArea = document.getElementById('authArea');
    const signInBtn = document.getElementById('signInBtn');
    const signOutBtn = document.getElementById('signOutBtn');

    let txns = []; let editId = null;

    function uid(){return 'id_'+Math.random().toString(36).slice(2,9)}
    function fmt(n){return Number(n||0).toLocaleString('en-IN',{minimumFractionDigits:2,maximumFractionDigits:2})}
    function escapeHtml(s){return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;')}

    function loadLocal(){try{txns = JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]')}catch(e){txns=[]}render();}
    function saveLocal(){localStorage.setItem(LOCAL_KEY,JSON.stringify(txns));render();}

    function render(){txTableBody.innerHTML='';let credits=0,debits=0;txns.slice().reverse().forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.date}</td><td><span class="tag ${t.type==='credit'?'credit':'debit'}">${t.type.toUpperCase()}</span></td><td>${escapeHtml(t.account||'')}</td><td>${escapeHtml(t.memo||'')}<div class="small">${escapeHtml(t.category||'')}</div></td><td class="right">₹ ${fmt(t.amount)}</td><td><button class="btn ghost" onclick="downloadInvoice('${t.id}')">PDF</button> <button class="btn ghost" onclick="editTxn('${t.id}')">Edit</button> <button class="btn ghost" onclick="deleteTxn('${t.id}')">Delete</button></td>`;txTableBody.appendChild(tr);if(Number(t.amount)>0){ if(t.type==='credit') credits+=Number(t.amount); else debits+=Number(t.amount) }});creditsEl.innerText=fmt(credits);debitsEl.innerText=fmt(debits);balanceEl.innerText=fmt(credits-debits);totalCountEl.innerText=txns.length}

    function newTxn(){editId=null;clearForm();openModal();document.getElementById('txnDate').value=new Date().toISOString().slice(0,10)}
    function clearForm(){document.getElementById('txnDate').value='';document.getElementById('txnType').value='credit';document.getElementById('txnAmount').value='';document.getElementById('txnAccount').value='';document.getElementById('txnCategory').value='';document.getElementById('txnRef').value='';document.getElementById('txnMemo').value='';}
    function openModal(){document.getElementById('modal').classList.add('open');document.getElementById('modalTitle').innerText=editId?'Edit Transaction':'New Transaction'}
    function closeModal(){document.getElementById('modal').classList.remove('open');editId=null;clearForm()}

    function editTxn(id){const t = txns.find(x=>x.id===id);if(!t) return alert('Not found');editId=id;document.getElementById('txnDate').value=t.date;document.getElementById('txnType').value=t.type;document.getElementById('txnAmount').value=t.amount;document.getElementById('txnAccount').value=t.account;document.getElementById('txnCategory').value=t.category;document.getElementById('txnRef').value=t.ref||'';document.getElementById('txnMemo').value=t.memo||'';openModal()}

    function deleteTxn(id){if(!confirm('Delete this transaction?'))return;txns=txns.filter(x=>x.id!==id);saveLocal();if(auth.currentUser) deleteFromCloud(id)}

    async function saveForm(){const date=document.getElementById('txnDate').value || new Date().toISOString().slice(0,10);const type=document.getElementById('txnType').value;const amount = Math.abs(Number(document.getElementById('txnAmount').value||0));if(!amount){return alert('Enter valid amount')}const account=document.getElementById('txnAccount').value;const category=document.getElementById('txnCategory').value;const ref=document.getElementById('txnRef').value;const memo=document.getElementById('txnMemo').value;if(editId){const idx = txns.findIndex(x=>x.id===editId);if(idx===-1)return alert('Edit failed');txns[idx] = {...txns[idx],date,type,amount,account,category,ref,memo};await updateCloud(txns[idx])} else {const obj={id:uid(),date,type,amount,account,category,ref,memo};txns.push(obj);await addToCloud(obj)}saveLocal();closeModal()}

    function exportCSV(){if(!txns.length) return alert('No transactions to export');const headers=['id','date','type','amount','account','category','ref','memo'];const csv = headers.join(',')+'
'+txns.map(t=>headers.map(h=>'"'+((t[h]||'').toString().replace(/"/g,'""'))+'"').join(',')).join('
');const blob = new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='luxury_txns.csv';a.click();URL.revokeObjectURL(url)}

    function downloadInvoice(id){const t = txns.find(x=>x.id===id);if(!t) return alert('Transaction not found');const { jsPDF } = window.jspdf;const doc = new jsPDF({unit:'pt',format:'a4'});const left=40;let y=60;doc.setFontSize(20);doc.text('Luxury Accounts — Invoice',left,y);y+=30;doc.setFontSize(12);doc.text(`Invoice ID: ${t.ref||t.id}`,left,y);y+=18;doc.text(`Date: ${t.date}`,left,y);y+=18;doc.text(`Account: ${t.account||''}`,left,y);y+=18;doc.text(`Category: ${t.category||''}`,left,y);y+=18;doc.text(`Memo: ${t.memo||''}`,left,y);y+=30;doc.setFontSize(14);doc.text(`Amount: ₹ ${fmt(t.amount)}`,left,y);y+=30;doc.setFontSize(10);doc.text('This is a system-generated invoice.',left,y);doc.save(`invoice_${t.id}.pdf`)}

    // ----------- Firestore helpers (modular) -----------
    async function addToCloud(tx){try{if(!auth.currentUser) return;await setDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',tx.id),tx);}catch(e){console.error('addToCloud',e)}}
    async function updateCloud(tx){try{if(!auth.currentUser) return;await setDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',tx.id),tx);}catch(e){console.error('updateCloud',e)}}
    async function deleteFromCloud(id){try{if(!auth.currentUser) return;await deleteDoc(doc(collection(db,'users'),auth.currentUser.uid,'txns',id));}catch(e){console.error('deleteFromCloud',e)}}

    async function pullFromCloud(){if(!auth.currentUser) return alert('Sign in to sync');try{const snap = await getDocs(collection(db,'users',auth.currentUser.uid,'txns'));const items=[];snap.forEach(d=>items.push(d.data()));txns = items;saveLocal();alert('Pulled '+items.length+' transactions from cloud')}catch(e){console.error(e);alert('Pull failed: '+e.message)}}

    async function pushToCloud(){if(!auth.currentUser) return alert('Sign in to sync');try{const collRef = collection(db,'users',auth.currentUser.uid,'txns');const existing = await getDocs(collRef);const batch = writeBatch(db);existing.forEach(d=>batch.delete(doc(collRef,d.id)));txns.forEach(t=>batch.set(doc(collRef,t.id),t));await batch.commit();alert('Pushed '+txns.length+' transactions to cloud')}catch(e){console.error(e);alert('Push failed: '+e.message)}}

    // ----------- Sheets sync (Apps Script) -----------
    async function syncWithSheets(){if(!SHEETS_ENDPOINT) return alert('Set SHEETS_ENDPOINT in the code');try{const res = await fetch(SHEETS_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'sync',txns})});const data = await res.json();if(data && data.txns){txns = data.txns;saveLocal();alert('Synced with Sheets: received '+data.txns.length+' rows')} else alert('Sheets sync complete')}catch(e){console.error(e);alert('Sheets sync failed: '+e.message)}}

    // ----------- Auth UI -----------
    const provider = new GoogleAuthProvider();
    async function startAuth(){try{await signInWithPopup(auth,provider)}catch(e){console.error('signin',e);alert('Sign-in failed: '+e.message)}}
    signInBtn.addEventListener('click',startAuth);
    signOutBtn.addEventListener('click',()=>signOut(auth));

    onAuthStateChanged(auth,user=>{if(user){authArea.innerText = `Signed in: ${user.displayName || user.email}`;signInBtn.style.display='none';signOutBtn.style.display='inline-block';pullFromCloud()} else {authArea.innerText='Not signed in';signInBtn.style.display='inline-block';signOutBtn.style.display='none'}});

    // CSV import
    function parseCSVLine(line){const out=[];let cur='';let inQ=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch==='"'){if(inQ && line[i+1]==='"'){cur+='"';i++} else {inQ=!inQ}} else if(ch===',' && !inQ){out.push(cur);cur=''} else {cur+=ch}}out.push(cur);return out.map(s=>s.replace(/^"|"$/g,'').replace(/""/g,'"'))}
    function importCSVFile(file){const reader=new FileReader();reader.onload=e=>{const text=e.target.result;const lines=text.split(/
?
/).filter(Boolean);if(!lines.length) return alert('CSV empty');const headers = lines[0].split(',').map(h=>h.replace(/"/g,'').trim());const newTx=[];for(let i=1;i<lines.length;i++){const cols=parseCSVLine(lines[i]);if(cols.length<headers.length) continue;const obj={};for(let j=0;j<headers.length;j++) obj[headers[j]] = cols[j];newTx.push({id:obj.id||uid(),date:obj.date||new Date().toISOString().slice(0,10),type:obj.type||'credit',amount:Math.abs(Number(obj.amount||0)),account:obj.account,category:obj.category,ref:obj.ref,memo:obj.memo});}txns = txns.concat(newTx);saveLocal();alert('Imported '+newTx.length+' rows')};reader.readAsText(file)}

    // Events
    document.getElementById('newTxnBtn').addEventListener('click',newTxn);
    document.getElementById('closeModal').addEventListener('click',closeModal);
    document.getElementById('saveTxn').addEventListener('click',saveForm);
    document.getElementById('clearForm').addEventListener('click',clearForm);
    document.getElementById('exportBtn').addEventListener('click',exportCSV);
    document.getElementById('syncSheetsBtn').addEventListener('click',syncWithSheets);
    document.getElementById('fileInput').addEventListener('change',e=>{if(e.target.files[0]) importCSVFile(e.target.files[0]);e.target.value='';});
    document.getElementById('globalSearch').addEventListener('input',function(e){const q=e.target.value.toLowerCase().trim();txTableBody.innerHTML='';const filtered=txns.filter(t=>[t.date,t.account,t.category,t.memo,t.ref,t.type,(t.amount||'')+""].join(' ').toLowerCase().includes(q));filtered.slice().reverse().forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.date}</td><td><span class="tag ${t.type==='credit'?'credit':'debit'}">${t.type.toUpperCase()}</span></td><td>${escapeHtml(t.account||'')}</td><td>${escapeHtml(t.memo||'')}<div class="small">${escapeHtml(t.category||'')}</div></td><td class="right">₹ ${fmt(t.amount)}</td><td><button class="btn ghost" onclick="downloadInvoice('${t.id}')">PDF</button> <button class="btn ghost" onclick="editTxn('${t.id}')">Edit</button> <button class="btn ghost" onclick="deleteTxn('${t.id}')">Delete</button></td>`;txTableBody.appendChild(tr);});});

    document.querySelectorAll('.nav button').forEach(b=>b.addEventListener('click',e=>{document.querySelectorAll('.nav button').forEach(x=>x.classList.remove('active'));b.classList.add('active');const view=b.dataset.view;if(view==='transactions') alert('Transactions view is dashboard here. Other views can be added.') }));

    // init
    loadLocal();
  </script>
 </body>
</html>
